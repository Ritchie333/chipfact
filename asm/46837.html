<!DOCTYPE html>
<html>
<head>
<title>Technician Ted: Routine at B6F5</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Technician Ted</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="46586.html">B5FA</a></span></td>
<td class="up">Up: <a href="../maps/all.html#46837">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="46893.html">B72D</a></span></td>
</tr>
</table>
<div class="description">B6F5: Print a number</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="45376.html">B140</a> and <a href="45778.html">B2D2</a>.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">The screen address to print</td>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">The number to print</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46837"></span>B6F5</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Remember this</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46838"></span>B6F6</td>
<td class="instruction">LD B,$08</td>
<td class="comment-11" rowspan="1">8 bits to check</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46840"></span>B6F8</td>
<td class="instruction">LD HL,$0001</td>
<td class="comment-11" rowspan="1">Set value to increment next bit to 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46843"></span>B6FB</td>
<td class="instruction">LD DE,$0000</td>
<td class="comment-11" rowspan="1">Set evaluated value to 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46846"></span>B6FE</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">Put working copy of number in C</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46847"></span>B6FF</td>
<td class="instruction">SRL C</td>
<td class="comment-11" rowspan="1">Get the next bit</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46849"></span>B701</td>
<td class="instruction">JR NC,$B70B</td>
<td class="comment-11" rowspan="1">Move on if it is not set</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46851"></span>B703</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="1">Get low value to increment by</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46852"></span>B704</td>
<td class="instruction">ADD A,E</td>
<td class="comment-11" rowspan="1">Add this to the current value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46853"></span>B705</td>
<td class="instruction">DAA</td>
<td class="comment-11" rowspan="1">Adjust for base 10</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46854"></span>B706</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1">Set it</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46855"></span>B707</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="1">Get high value to increment by</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46856"></span>B708</td>
<td class="instruction">ADC A,D</td>
<td class="comment-11" rowspan="1">Add this to the current value (including carry)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46857"></span>B709</td>
<td class="instruction">DAA</td>
<td class="comment-11" rowspan="1">Adjust for base 10</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46858"></span>B70A</td>
<td class="instruction">LD D,A</td>
<td class="comment-11" rowspan="1">Set it</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46859"></span>B70B</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="1">Get low value to increment</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46860"></span>B70C</td>
<td class="instruction">ADD A,L</td>
<td class="comment-11" rowspan="1">Double it so that next bit gets the appropriate value added</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46861"></span>B70D</td>
<td class="instruction">DAA</td>
<td class="comment-11" rowspan="1">Adjust to base 10</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46862"></span>B70E</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1">Set it</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46863"></span>B70F</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="1">Get low value to increment</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46864"></span>B710</td>
<td class="instruction">ADC A,H</td>
<td class="comment-11" rowspan="1">Double it (including carry)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46865"></span>B711</td>
<td class="instruction">DAA</td>
<td class="comment-11" rowspan="1">Adjust to base 10</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46866"></span>B712</td>
<td class="instruction">LD H,A</td>
<td class="comment-11" rowspan="1">Set it</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46867"></span>B713</td>
<td class="instruction">DJNZ $B6FF</td>
<td class="comment-11" rowspan="1">Loop if there are more bits to do</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46869"></span>B715</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore HL</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="46870"></span>
<div class="comments">
<div class="paragraph">
At this point, DE contains three digits of an 8-bit number in D, bits 4-7 of E and bits 0-3 of E
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46870"></span>B716</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="1">Get the high value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46871"></span>B717</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Is it &gt; 0?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46872"></span>B718</td>
<td class="instruction">CALL NZ,$B72B</td>
<td class="comment-11" rowspan="1">If it isn't, print digit</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46875"></span>B71B</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1">Get the low value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46876"></span>B71C</td>
<td class="instruction">AND $F0</td>
<td class="comment-11" rowspan="1">Get the top bits</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46878"></span>B71E</td>
<td class="instruction">CALL NZ,$B727</td>
<td class="comment-11" rowspan="1">If any are set, print digit</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46881"></span>B721</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1">Get the low value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46882"></span>B722</td>
<td class="instruction">AND $0F</td>
<td class="comment-11" rowspan="1">Get the bottom bits</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46884"></span>B724</td>
<td class="instruction">JP $B72B</td>
<td class="comment-11" rowspan="1">This always needs printing, so do it</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46887"></span>B727</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="4">Shift the top bits in the low value to match a printable number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46888"></span>B728</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46889"></span>B729</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46890"></span>B72A</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46891"></span>B72B</td>
<td class="instruction">ADD A,$30</td>
<td class="comment-11" rowspan="1">Convert number to ASCII - control then continues to <a href="46893.html">B72D</a></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="46586.html">B5FA</a></span></td>
<td class="up">Up: <a href="../maps/all.html#46837">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="46893.html">B72D</a></span></td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">Copyright Steve Marsden and David Cooke 1984. This dissassembly by Ritchie Swann 2018.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 7.0.</div>
</footer>
</body>
</html>