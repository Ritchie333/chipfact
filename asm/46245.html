<!DOCTYPE html>
<html>
<head>
<title>Technician Ted: Routine at B4A5</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Technician Ted</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="46144.html">B440</a></span></td>
<td class="up">Up: <a href="../maps/all.html#46245">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="46566.html">B5E6</a></span></td>
</tr>
</table>
<div class="description">B4A5: Put moving objects into the live buffer</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="44663.html">AE77</a>.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IX</td>
<td class="register-desc">Pointer to the moving object buffer</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Pointer to data from the room</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46245"></span>B4A5</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-11" rowspan="3">Put the initial offset value in DE</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46246"></span>B4A6</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46247"></span>B4A7</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46248"></span>B4A8</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="2">Is it zero?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46249"></span>B4A9</td>
<td class="instruction">OR E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46250"></span>B4AA</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">All done with moving objects, nothing else to do</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="46251"></span>
<div class="comments">
<div class="paragraph">
Store moving object flags
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46251"></span>B4AB</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="6">Keep bit 7 in place and right shift all other bits</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46252"></span>B4AC</td>
<td class="instruction">RRA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46253"></span>B4AD</td>
<td class="instruction">XOR D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46254"></span>B4AE</td>
<td class="instruction">AND $0F</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46256"></span>B4B0</td>
<td class="instruction">XOR D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46257"></span>B4B1</td>
<td class="instruction">AND $AF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46259"></span>B4B3</td>
<td class="instruction">LD (IX+$06),A</td>
<td class="comment-11" rowspan="1">Store flags</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="46262"></span>
<div class="comments">
<div class="paragraph">
Store position
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46262"></span>B4B6</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="3">Get bit 0 of D</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46263"></span>B4B7</td>
<td class="instruction">AND $01</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46265"></span>B4B9</td>
<td class="instruction">LD D,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46266"></span>B4BA</td>
<td class="instruction">RLC A</td>
<td class="comment-11" rowspan="4">Convert to graphic offset</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46268"></span>B4BC</td>
<td class="instruction">RLC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46270"></span>B4BE</td>
<td class="instruction">RLC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46272"></span>B4C0</td>
<td class="instruction">ADD A,$80</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46274"></span>B4C2</td>
<td class="instruction">LD (IX+$01),A</td>
<td class="comment-11" rowspan="2">Store it</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46277"></span>B4C5</td>
<td class="instruction">LD (IX+$00),E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46280"></span>B4C8</td>
<td class="instruction">LD B,$02</td>
<td class="comment-11" rowspan="1">Two entries</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46282"></span>B4CA</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Move to next entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46283"></span>B4CB</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Remember this</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46284"></span>B4CC</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Get the value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46285"></span>B4CD</td>
<td class="instruction">AND $1F</td>
<td class="comment-11" rowspan="1">Extract bits 0-4</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46287"></span>B4CF</td>
<td class="instruction">BIT 7,(IX+$06)</td>
<td class="comment-11" rowspan="2">Move ahead if this left / right movement</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46291"></span>B4D3</td>
<td class="instruction">JR Z,$B4E3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46293"></span>B4D5</td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="10">Change the displacement value to reflect up / down</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46294"></span>B4D6</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46295"></span>B4D7</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46296"></span>B4D8</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46297"></span>B4D9</td>
<td class="instruction">RR D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46299"></span>B4DB</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46300"></span>B4DC</td>
<td class="instruction">RL D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46302"></span>B4DE</td>
<td class="instruction">XOR E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46303"></span>B4DF</td>
<td class="instruction">AND $E0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46305"></span>B4E1</td>
<td class="instruction">JR $B4E6</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46307"></span>B4E3</td>
<td class="instruction">XOR E</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46308"></span>B4E4</td>
<td class="instruction">AND $1F</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46310"></span>B4E6</td>
<td class="instruction">XOR E</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46311"></span>B4E7</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46312"></span>B4E8</td>
<td class="instruction">LD HL,$A000</td>
<td class="comment-11" rowspan="1">Point to attributes buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46315"></span>B4EB</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="1">Add offset</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46316"></span>B4EC</td>
<td class="instruction">EX (SP),HL</td>
<td class="comment-11" rowspan="1">Put the offset on stack and restore pointer to next room data byte</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46317"></span>B4ED</td>
<td class="instruction">DJNZ $B4CA</td>
<td class="comment-11" rowspan="1">Loop back if more to do</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46319"></span>B4EF</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Get first value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46320"></span>B4F0</td>
<td class="instruction">LD (IX+$04),C</td>
<td class="comment-11" rowspan="2">Set first screen bounds</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46323"></span>B4F3</td>
<td class="instruction">LD (IX+$05),B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46326"></span>B4F6</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Get second value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46327"></span>B4F7</td>
<td class="instruction">LD (IX+$02),C</td>
<td class="comment-11" rowspan="2">Set second screen bounds</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46330"></span>B4FA</td>
<td class="instruction">LD (IX+$03),B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46333"></span>B4FD</td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="1">Move back to get the attribute</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46334"></span>B4FE</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Get next value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46335"></span>B4FF</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="4">Extract height</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46336"></span>B500</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46337"></span>B501</td>
<td class="instruction">AND $38</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46339"></span>B503</td>
<td class="instruction">ADD A,$08</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46341"></span>B505</td>
<td class="instruction">LD (IX+$07),A</td>
<td class="comment-11" rowspan="1">Store it</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46344"></span>B508</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Next value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46345"></span>B509</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Get value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46346"></span>B50A</td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="5">Extract width</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46347"></span>B50B</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46348"></span>B50C</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46349"></span>B50D</td>
<td class="instruction">AND $03</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46351"></span>B50F</td>
<td class="instruction">INC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46352"></span>B510</td>
<td class="instruction">LD (IX+$08),A</td>
<td class="comment-11" rowspan="1">Store it</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46355"></span>B513</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Next value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46356"></span>B514</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Get attribute</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46357"></span>B515</td>
<td class="instruction">LD (IX+$09),A</td>
<td class="comment-11" rowspan="1">Store it</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46360"></span>B518</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Next value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46361"></span>B519</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Remember this</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46362"></span>B51A</td>
<td class="instruction">LD L,(HL)</td>
<td class="comment-11" rowspan="1">Convert from graphic offset to word</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46363"></span>B51B</td>
<td class="instruction">LD H,$00</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46365"></span>B51D</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46366"></span>B51E</td>
<td class="instruction">LD BC,($A469)</td>
<td class="comment-11" rowspan="1">Get base pointer to moving graphic offsets</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46370"></span>B522</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-11" rowspan="1">Get the appropriate value for this graphic</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46371"></span>B523</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-11" rowspan="3">Put the offsest in BC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46372"></span>B524</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46373"></span>B525</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46374"></span>B526</td>
<td class="instruction">LD HL,($A46B)</td>
<td class="comment-11" rowspan="1">Get base pointer to moving graphics</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46377"></span>B529</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-11" rowspan="1">Add the offset</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46378"></span>B52A</td>
<td class="instruction">LD (IX+$0A),L</td>
<td class="comment-11" rowspan="4">Store the value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46381"></span>B52D</td>
<td class="instruction">LD (IX+$0C),L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46384"></span>B530</td>
<td class="instruction">LD (IX+$0B),H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46387"></span>B533</td>
<td class="instruction">LD (IX+$0D),H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46390"></span>B536</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46391"></span>B537</td>
<td class="instruction">LD A,$01</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46393"></span>B539</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Move to next value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46394"></span>B53A</td>
<td class="instruction">BIT 2,(IX+$06)</td>
<td class="comment-11" rowspan="2">Skip if bit 2 of the flags set</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46398"></span>B53E</td>
<td class="instruction">JR Z,$B542</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46400"></span>B540</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Get next value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46401"></span>B541</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Point to next entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46402"></span>B542</td>
<td class="instruction">LD (IX+$0E),A</td>
<td class="comment-11" rowspan="4">Store offset between frames</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46405"></span>B545</td>
<td class="instruction">LD (IX+$0F),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46408"></span>B548</td>
<td class="instruction">LD (IX+$10),$00</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46412"></span>B54C</td>
<td class="instruction">LD (IX+$11),$00</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46416"></span>B550</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46417"></span>B551</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46418"></span>B552</td>
<td class="instruction">AND $07</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46420"></span>B554</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46421"></span>B555</td>
<td class="instruction">LD (IX+$12),A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46424"></span>B558</td>
<td class="instruction">LD (IX+$13),$FF</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46428"></span>B55C</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46429"></span>B55D</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46430"></span>B55E</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46431"></span>B55F</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46432"></span>B560</td>
<td class="instruction">AND $07</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46434"></span>B562</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46435"></span>B563</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46436"></span>B564</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46437"></span>B565</td>
<td class="instruction">SCF</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46438"></span>B566</td>
<td class="instruction">RLA</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46439"></span>B567</td>
<td class="instruction">DJNZ $B565</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46441"></span>B569</td>
<td class="instruction">LD (IX+$1C),A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46444"></span>B56C</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46445"></span>B56D</td>
<td class="instruction">LD A,$01</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46447"></span>B56F</td>
<td class="instruction">BIT 2,(IX+$06)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46451"></span>B573</td>
<td class="instruction">JR Z,$B577</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46453"></span>B575</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46454"></span>B576</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46455"></span>B577</td>
<td class="instruction">LD (IX+$18),A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46458"></span>B57A</td>
<td class="instruction">LD (IX+$19),A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="46461"></span>
<div class="comments">
<div class="paragraph">
Store the speed
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46461"></span>B57D</td>
<td class="instruction">LD A,$01</td>
<td class="comment-11" rowspan="1">Default value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46463"></span>B57F</td>
<td class="instruction">BIT 1,(IX+$06)</td>
<td class="comment-11" rowspan="1">Is the "default speed" flag set?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46467"></span>B583</td>
<td class="instruction">JR Z,$B587</td>
<td class="comment-11" rowspan="1">Move on if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46469"></span>B585</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Get next value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46470"></span>B586</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Move to point to next entry in the room data</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46471"></span>B587</td>
<td class="instruction">LD (IX+$1A),A</td>
<td class="comment-11" rowspan="2">Store speed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46474"></span>B58A</td>
<td class="instruction">LD (IX+$1B),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46477"></span>B58D</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46478"></span>B58E</td>
<td class="instruction">LD D,B</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46479"></span>B58F</td>
<td class="instruction">LD C,(IX+$07)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46482"></span>B592</td>
<td class="instruction">LD E,(IX+$08)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46485"></span>B595</td>
<td class="instruction">CALL <a href="46566.html">$B5E6</a></td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46488"></span>B598</td>
<td class="instruction">LD (IX+$14),L</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46491"></span>B59B</td>
<td class="instruction">LD (IX+$15),H</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46494"></span>B59E</td>
<td class="instruction">BIT 7,(IX+$06)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46498"></span>B5A2</td>
<td class="instruction">JR NZ,$B5AF</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46500"></span>B5A4</td>
<td class="instruction">LD A,(IX+$12)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46503"></span>B5A7</td>
<td class="instruction">BIT 3,A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46505"></span>B5A9</td>
<td class="instruction">JR NZ,$B5AF</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46507"></span>B5AB</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46508"></span>B5AC</td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46509"></span>B5AD</td>
<td class="instruction">JR $B5A7</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46511"></span>B5AF</td>
<td class="instruction">LD (IX+$16),L</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46514"></span>B5B2</td>
<td class="instruction">LD (IX+$17),H</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46517"></span>B5B5</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46518"></span>B5B6</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46519"></span>B5B7</td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46520"></span>B5B8</td>
<td class="instruction">PUSH DE</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46521"></span>B5B9</td>
<td class="instruction">BIT 6,A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46523"></span>B5BB</td>
<td class="instruction">JR Z,$B5C1</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46525"></span>B5BD</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46526"></span>B5BE</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46527"></span>B5BF</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46528"></span>B5C0</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46529"></span>B5C1</td>
<td class="instruction">LD (IX+$1D),E</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46532"></span>B5C4</td>
<td class="instruction">LD (IX+$1E),D</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46535"></span>B5C7</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46536"></span>B5C8</td>
<td class="instruction">LD DE,$0000</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46539"></span>B5CB</td>
<td class="instruction">BIT 7,A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46541"></span>B5CD</td>
<td class="instruction">JR Z,$B5D8</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46543"></span>B5CF</td>
<td class="instruction">LD E,(IX+$0E)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46546"></span>B5D2</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46547"></span>B5D3</td>
<td class="instruction">CALL <a href="46566.html">$B5E6</a></td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46550"></span>B5D6</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46551"></span>B5D7</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="46552"></span>B5D8</td>
<td class="instruction">LD (IX+$1F),E</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46555"></span>B5DB</td>
<td class="instruction">LD (IX+$20),D</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46558"></span>B5DE</td>
<td class="instruction">LD DE,$0021</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46561"></span>B5E1</td>
<td class="instruction">ADD IX,DE</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="46563"></span>B5E3</td>
<td class="instruction">JP $B4A5</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="46144.html">B440</a></span></td>
<td class="up">Up: <a href="../maps/all.html#46245">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="46566.html">B5E6</a></span></td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">Copyright Steve Marsden and David Cooke 1984. This dissassembly by Ritchie Swann 2018.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 7.0.</div>
</footer>
</body>
</html>